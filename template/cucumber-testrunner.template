<!doctype html>
<html>
  <head>
    <script src="lib/cucumber.js"></script>
    <!--<script src="/testem.js"></script>-->
    <script src="features.js"></script>
    <% _.each(modules, function(module) { %>
    <script src="<%= module.filepath %>"></script>
    <% }); %>
    <% if(listener.exists) { %>
      <script src="script/<%= listener.filename %>"></script>
    <% }; %>
  </head>
  <body>
    <p>hello, world</p>
    <script>
      (function(window) {
        
        // Need to concat all *.features > browserify.standalone = cukefeatures
        var features = window.cukefeatures.split('&crarr').join('\n');

        // Need to concat all support + step_definitions, and export as a function
        var support = function() {
          this.Given = this.When = this.Then = this.defineStep;
          // Would be put on window if /support/world found.
          if('world' in window) {
            this.World = window['world'].World;
          }
          <% _.each(steps, function(step) { %>
          window['<%= step.name %>'].call(this);
          <% }); %>
        };

        var runtime = Cucumber(features, support);
        <% if(listener.exists) { %>
          runtime.attachListener(window.cukelistener.instance());
        <% }; %>
        runtime.start(function(){
          console.log(Array.prototype.slice.call(arguments));
        });
      }(window));
    </script>
  </body>
</html>